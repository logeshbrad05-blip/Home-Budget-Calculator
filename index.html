<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Home Budget Calculator</title>
  <style>
    /* Root page layout */
body {
    margin: 0;
    padding: 0;
    background: #e9eef5;
    font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial;
}

/* Main responsive frame */
.container {
    max-width: 900px;              /* Keeps layout centered on large screens */
    width: 95%;                    /* Ensures it fits on all screen sizes */
    margin: 20px auto;             /* Centers the frame */
    padding: 20px;
    background: #ffffff;           /* White frame around everything */
    border-radius: 16px;
    box-shadow: 0 6px 25px rgba(0,0,0,0.08);
    overflow: hidden;              /* Ensures nothing spills out */
}

/* Section cards inside the frame */
.section {
    background: #ffffff;
    border-radius: 12px;
    padding: 16px;
    margin-bottom: 16px;
    box-shadow: 0 4px 14px rgba(0,0,0,0.05);
}

/* Each row is responsive */
.row {
    display: flex;
    flex-wrap: wrap;               /* KEY FIX: wrap items on small screens */
    justify-content: space-between;
    gap: 12px;
    align-items: center;
    padding: 10px 0;
    border-bottom: 1px solid #efefef;
}

/* Inputs auto-scale */
.row input[type="number"],
.row input[type="date"] {
    flex: 1;                       /* Responsive width */
    min-width: 150px;
    max-width: 260px;
    padding: 8px 10px;
    border: 1px solid #ddd;
    border-radius: 8px;
}

/* Add-buttons row fixes */
.add-row {
    display: flex;
    gap: 8px;
    align-items: center;
    flex-wrap: nowrap;
}

/* Mobile optimization */
@media (max-width: 600px) {
    .row {
        flex-direction: column;
        align-items: flex-start;
    }
    .add-row {
        width: 100%;
    }
    .add-row input {
        flex: 1;
        min-width: 120px;
    }
}

/* Totals bottom section */
.totals {
    display: flex;
    flex-wrap: wrap;
    gap: 12px;
    justify-content: flex-end;
    margin-top: 18px;
}

.total-item {
    flex: 1;
    min-width: 160px;
    padding: 14px;
    border-radius: 12px;
    text-align: center;
    background: #ffffff;
    box-shadow: 0 3px 12px rgba(0,0,0,0.05);
}

/* Greeting section adapts too */
.greeting {
    padding: 14px;
    border-radius: 14px;
    margin-bottom: 18px;
    background: linear-gradient(90deg, rgba(43,108,176,0.08), rgba(43,108,176,0.04));
}

/* Print-friendly frame */
@media print {
    body {
        background: #ffffff !important;
    }
    .container {
        width: 100%;
        max-width: 100%;
        box-shadow: none;
        border-radius: 0;
        margin: 0;
        padding: 0;
    }
}
/* -------------------------
   GLOBAL RESET + BASE
------------------------- */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial;
    background: #f6f8fb;
    color: #222;
    padding: 20px;
}

/* -------------------------
   APP CONTAINER (MAIN CARD)
------------------------- */
.container {
    max-width: 900px;
    width: 95%;
    margin: auto;
    background: #fff;
    border-radius: 22px;
    padding: 26px;
    box-shadow: 0 12px 40px rgba(0,0,0,0.08);
}

/* -------------------------
   GREETING / HEADER
------------------------- */
.greeting {
    background: linear-gradient(145deg, #edf2ff, #e9f5ff);
    padding: 18px 20px;
    border-radius: 18px;
    margin-bottom: 22px;
    font-size: 1rem;
    line-height: 1.45;
    font-weight: 500;
    border-left: 6px solid #3b82f6;
}

/* -------------------------
   SECTION TITLE
------------------------- */
.section h3 {
    margin-bottom: 14px;
    font-size: 1.2rem;
    font-weight: 600;
    color: #1e3a8a;
    padding-left: 4px;
}

/* -------------------------
   EXPENSE ROW CARD
------------------------- */
.input-group {
    background: #ffffff;
    padding: 14px 16px;
    border-radius: 16px;
    display: flex;
    flex-direction: column;
    margin-bottom: 14px;
    box-shadow: 0 3px 14px rgba(0,0,0,0.05);
}

/* LABEL WITH ICON */
.input-group label {
    display: flex;
    align-items: center;
    gap: 8px;
    font-weight: 600;
    font-size: 0.95rem;
    margin-bottom: 8px;
}

/* INPUT FIELD */
.input-group input[type="number"],
.input-group input[type="date"] {
    width: 100%;
    padding: 10px 12px;
    border-radius: 12px;
    border: 1px solid #d0d7e6;
    font-size: 0.95rem;
    transition: 0.2s ease;
}

.input-group input:focus {
    outline: none;
    border-color: #3b82f6;
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.15);
}

/* -------------------------
   ADD-TO ROW
------------------------- */
.add-row {
    display: flex;
    gap: 10px;
    margin-top: 10px;
}

.add-row input {
    flex: 1;
    padding: 8px 10px;
    border-radius: 10px;
    border: 1px solid #d6d6d6;
}

.add-row button {
    padding: 8px 14px;
    border-radius: 10px;
    background: #10b981;
    color: #fff;
    border: none;
    cursor: pointer;
    font-size: 0.85rem;
    transition: 0.2s ease;
}

.add-row button:hover {
    background: #059669;
}

/* -------------------------
   TOTALS CARD
------------------------- */
.totals {
    display: flex;
    gap: 16px;
    justify-content: space-between;
    margin-top: 22px;
}

.total-item {
    flex: 1;
    background: #ffffff;
    padding: 18px;
    border-radius: 18px;
    text-align: center;
    font-weight: 600;
    box-shadow: 0 3px 14px rgba(0,0,0,0.06);
}

.total-item span {
    display: block;
    margin-top: 6px;
    font-size: 1.4rem;
}

.total-item.positive {
    color: #16a34a;
}

/* -------------------------
   RESPONSIVE BEHAVIOR
------------------------- */
@media (max-width: 600px) {
    .totals {
        flex-direction: column;
    }
}

/* -------------------------
   FOOTER / CREDENTIALS
------------------------- */
.footer {
    margin-top: 30px;
    text-align: center;
    font-size: 0.85rem;
    opacity: 0.75;
    line-height: 1.5;
}
 </style>

  <!-- html2canvas + jsPDF (CDN) for screenshot-style PDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
</head>
<body>
  <div class="container" id="mainContent">
    <!-- Greeting -->
    <div class="greeting" role="banner">
      Welcome to your Home Budget Calculator!<br />
      Take control of your finances effortlessly and plan your spending smartly.<br />
      Let‚Äôs make budgeting simple, clear, and empowering for you!
    </div>

    <!-- Date & Deposits + Controls -->
    <div class="section" style="margin-bottom:12px;">
      <div style="display:flex;gap:12px;align-items:center;flex-wrap:wrap;">
        <div style="display:flex;gap:12px;align-items:center;">
          <label><span class="icon">üìÖ</span> Date</label>
          <input type="date" id="date" onchange="saveEntry()" />
        </div>
        <div style="display:flex;gap:12px;align-items:center;">
          <label><span class="icon">üí∞</span> Deposits ‚Çπ</label>
          <input type="number" id="deposits" min="0" step="0.01" value="0" oninput="calculate()" />
        </div>
        <div class="controls" style="flex:1;align-items:center">
          <div class="left note">Tip: double-click any item name to edit it.</div>
          <button id="exportPdfBtn" onclick="exportPDF()">üìÑ Export PDF</button>
          <button onclick="window.print()" class="ghost">üñ® Print</button>
        </div>
      </div>
    </div>

    <!-- Expenses -->
    <div class="section" id="expensesSection">
      <h3 style="margin-top:0">üè° Your Household Expenses</h3>

      <!-- helper: rows created manually to ensure order & icons -->
      <!-- Rice -->
      <div class="row">
        <label>
          <img class="icon" src='data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="52" height="36" viewBox="0 0 52 36"><rect rx="6" width="52" height="36" fill="%23fff7ea"/><path d="M26 6c6 3 8 8 8 12 0 6-6 10-8 12-2-2-8-6-8-12 0-4 2-9 8-12z" fill="%23f4c542"/></svg>' alt="Rice" />
          <span class="editable-label" ondblclick="makeEditable(this)" onblur="makeReadOnly(this)" contenteditable="false">Rice ‚Çπ</span>
        </label>
        <input type="number" id="rice" oninput="calculate()" placeholder="0" min="0" step="0.01" />
        <div class="add-row">
          <input type="number" id="riceAdd" min="0" step="0.01" placeholder="0" />
          <button onclick="addTo('rice')">‚ûï Add</button>
        </div>
      </div>

      <!-- Electricity -->
      <div class="row">
        <label>
          <span class="icon-wrap">‚ö°</span>
          <span class="editable-label" ondblclick="makeEditable(this)" onblur="makeReadOnly(this)" contenteditable="false">Electricity ‚Çπ</span>
        </label>
        <input type="number" id="electricity" oninput="calculate()" placeholder="0" min="0" step="0.01" />
        <div class="add-row"><input id="electricityAdd" type="number" min="0" step="0.01" placeholder="0" /><button onclick="addTo('electricity')">‚ûï Add</button></div>
      </div>

      <!-- Milk -->
      <div class="row">
        <label>
          <img class="icon" src='data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="48" height="36" viewBox="0 0 48 36"><rect rx="6" width="48" height="36" fill="%23f6fbff"/><path d="M28 6c-1-2-6-2-8 0l-2 4v16h16V10z" fill="%23fff"/><rect x="20" y="8" width="8" height="3" rx="1" fill="%23e6f2ff"/></svg>' alt="Milk" />
          <span class="editable-label" ondblclick="makeEditable(this)" onblur="makeReadOnly(this)" contenteditable="false">Milk ‚Çπ</span>
        </label>
        <input type="number" id="milk" oninput="calculate()" placeholder="0" min="0" step="0.01" />
        <div class="add-row"><input id="milkAdd" type="number" min="0" step="0.01" placeholder="0" /><button onclick="addTo('milk')">‚ûï Add</button></div>
      </div>

      <!-- Cylinder -->
      <div class="row">
        <label>
          <img class="icon" src='data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="48" height="36" viewBox="0 0 48 36"><rect rx="6" width="48" height="36" fill="%23fffaf0"/><path d="M14 12h20v10a6 6 0 0 1-6 6H20a6 6 0 0 1-6-6V12z" fill="%23f05454"/><rect x="18" y="8" width="12" height="6" rx="2" fill="%23fff"/></svg>' alt="Cylinder" />
          <span class="editable-label" ondblclick="makeEditable(this)" onblur="makeReadOnly(this)" contenteditable="false">Cylinder ‚Çπ</span>
        </label>
        <input type="number" id="cylinder" oninput="calculate()" placeholder="0" min="0" step="0.01" />
        <div class="add-row"><input id="cylinderAdd" type="number" min="0" step="0.01" placeholder="0" /><button onclick="addTo('cylinder')">‚ûï Add</button></div>
      </div>

      <!-- Non-Veg -->
      <div class="row">
        <label><span class="icon-wrap">üçó</span><span class="editable-label" ondblclick="makeEditable(this)" onblur="makeReadOnly(this)" contenteditable="false">Non-Veg ‚Çπ</span></label>
        <input type="number" id="nonveg" oninput="calculate()" placeholder="0" min="0" step="0.01" />
        <div class="add-row"><input id="nonvegAdd" type="number" min="0" step="0.01" placeholder="0" /><button onclick="addTo('nonveg')">‚ûï Add</button></div>
      </div>

      <!-- Eggs -->
      <div class="row">
        <label><span class="icon-wrap">ü•ö</span><span class="editable-label" ondblclick="makeEditable(this)" onblur="makeReadOnly(this)" contenteditable="false">Eggs ‚Çπ</span></label>
        <input type="number" id="eggs" oninput="calculate()" placeholder="0" min="0" step="0.01" />
        <div class="add-row"><input id="eggsAdd" type="number" min="0" step="0.01" placeholder="0" /><button onclick="addTo('eggs')">‚ûï Add</button></div>
      </div>

      <!-- Veggies -->
      <div class="row">
        <label><span class="icon-wrap">ü•¨</span><span class="editable-label" ondblclick="makeEditable(this)" onblur="makeReadOnly(this)" contenteditable="false">Veggies ‚Çπ</span></label>
        <input type="number" id="veggies" oninput="calculate()" placeholder="0" min="0" step="0.01" />
        <div class="add-row"><input id="veggiesAdd" type="number" min="0" step="0.01" placeholder="0" /><button onclick="addTo('veggies')">‚ûï Add</button></div>
      </div>

      <!-- Grocery Canteen -->
      <div class="row">
        <label><span class="icon-wrap">üõí</span><span class="editable-label" ondblclick="makeEditable(this)" onblur="makeReadOnly(this)" contenteditable="false">Grocery Canteen ‚Çπ</span></label>
        <input type="number" id="canteen" oninput="calculate()" placeholder="0" min="0" step="0.01" />
        <div class="add-row"><input id="canteenAdd" type="number" min="0" step="0.01" placeholder="0" /><button onclick="addTo('canteen')">‚ûï Add</button></div>
      </div>

      <!-- Paneer -->
      <div class="row">
        <label><span class="icon-wrap">üßÄ</span><span class="editable-label" ondblclick="makeEditable(this)" onblur="makeReadOnly(this)" contenteditable="false">Paneer ‚Çπ</span></label>
        <input type="number" id="paneer" oninput="calculate()" placeholder="0" min="0" step="0.01" />
        <div class="add-row"><input id="paneerAdd" type="number" min="0" step="0.01" placeholder="0" /><button onclick="addTo('paneer')">‚ûï Add</button></div>
      </div>

      <!-- Extras -->
      <div class="row">
        <label><span class="icon-wrap">‚ú®</span><span class="editable-label" ondblclick="makeEditable(this)" onblur="makeReadOnly(this)" contenteditable="false">Extras ‚Çπ</span></label>
        <input type="number" id="extras" oninput="calculate()" placeholder="0" min="0" step="0.01" />
        <div class="add-row"><input id="extrasAdd" type="number" min="0" step="0.01" placeholder="0" /><button onclick="addTo('extras')">‚ûï Add</button></div>
      </div>

      <!-- Snacks -->
      <div class="row">
        <label><span class="icon-wrap">üçø</span><span class="editable-label" ondblclick="makeEditable(this)" onblur="makeReadOnly(this)" contenteditable="false">Snacks ‚Çπ</span></label>
        <input type="number" id="snacks" oninput="calculate()" placeholder="0" min="0" step="0.01" />
        <div class="add-row"><input id="snacksAdd" type="number" min="0" step="0.01" placeholder="0" /><button onclick="addTo('snacks')">‚ûï Add</button></div>
      </div>

      <!-- Ration Shop -->
      <div class="row">
        <label><span class="icon-wrap">üè™</span><span class="editable-label" ondblclick="makeEditable(this)" onblur="makeReadOnly(this)" contenteditable="false">Ration Shop ‚Çπ</span></label>
        <input type="number" id="ration" oninput="calculate()" placeholder="0" min="0" step="0.01" />
        <div class="add-row"><input id="rationAdd" type="number" min="0" step="0.01" placeholder="0" /><button onclick="addTo('ration')">‚ûï Add</button></div>
      </div>

      <!-- Provision -->
      <div class="row">
        <label><span class="icon-wrap">üõí</span><span class="editable-label" ondblclick="makeEditable(this)" onblur="makeReadOnly(this)" contenteditable="false">Provision ‚Çπ</span></label>
        <input type="number" id="provision" oninput="calculate()" placeholder="0" min="0" step="0.01" />
        <div class="add-row"><input id="provisionAdd" type="number" min="0" step="0.01" placeholder="0" /><button onclick="addTo('provision')">‚ûï Add</button></div>
      </div>

      <!-- Fruits -->
      <div class="row">
        <label><span class="icon-wrap">üçé</span><span class="editable-label" ondblclick="makeEditable(this)" onblur="makeReadOnly(this)" contenteditable="false">Fruits ‚Çπ</span></label>
        <input type="number" id="fruits" oninput="calculate()" placeholder="0" min="0" step="0.01" />
        <div class="add-row"><input id="fruitsAdd" type="number" min="0" step="0.01" placeholder="0" /><button onclick="addTo('fruits')">‚ûï Add</button></div>
      </div>

      <!-- Cooking Oil -->
      <div class="row">
        <label>
          <img class="icon" src='data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="48" height="36" viewBox="0 0 48 36"><rect rx="6" width="48" height="36" fill="%23fffef6"/><path d="M16 8h16v16a6 6 0 0 1-6 6H22a6 6 0 0 1-6-6V8z" fill="%23ffd166"/><path d="M24 6c2 0 2 2 0 2s-2-2 0-2z" fill="%23f4a261"/></svg>' alt="Oil" />
          <span class="editable-label" ondblclick="makeEditable(this)" onblur="makeReadOnly(this)" contenteditable="false">Cooking Oil ‚Çπ</span>
        </label>
        <input type="number" id="oil" oninput="calculate()" placeholder="0" min="0" step="0.01" />
        <div class="add-row"><input id="oilAdd" type="number" min="0" step="0.01" placeholder="0" /><button onclick="addTo('oil')">‚ûï Add</button></div>
      </div>

      <!-- Curd -->
      <div class="row">
        <label><span class="icon-wrap">ü•õ</span><span class="editable-label" ondblclick="makeEditable(this)" onblur="makeReadOnly(this)" contenteditable="false">Curd ‚Çπ</span></label>
        <input type="number" id="curd" oninput="calculate()" placeholder="0" min="0" step="0.01" />
        <div class="add-row"><input id="curdAdd" type="number" min="0" step="0.01" placeholder="0" /><button onclick="addTo('curd')">‚ûï Add</button></div>
      </div>

      <!-- Water (added) -->
      <div class="row">
        <label>
          <img class="icon" src='data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="48" height="36" viewBox="0 0 48 36"><rect rx="6" width="48" height="36" fill="%23f0fbff"/><path d="M24 6c-4 6-8 8-8 12a8 8 0 0 0 16 0c0-4-4-6-8-12z" fill="%2300a1e4"/></svg>' alt="Water" />
          <span class="editable-label" ondblclick="makeEditable(this)" onblur="makeReadOnly(this)" contenteditable="false">Water ‚Çπ</span>
        </label>
        <input type="number" id="water" oninput="calculate()" placeholder="0" min="0" step="0.01" />
        <div class="add-row"><input id="waterAdd" type="number" min="0" step="0.01" placeholder="0" /><button onclick="addTo('water')">‚ûï Add</button></div>
      </div>

      <!-- Flowers -->
      <div class="row">
        <label><span class="icon-wrap">üå∏</span><span class="editable-label" ondblclick="makeEditable(this)" onblur="makeReadOnly(this)" contenteditable="false">Flowers ‚Çπ</span></label>
        <input type="number" id="flowers" oninput="calculate()" placeholder="0" min="0" step="0.01" />
        <div class="add-row"><input id="flowersAdd" type="number" min="0" step="0.01" placeholder="0" /><button onclick="addTo('flowers')">‚ûï Add</button></div>
      </div>

      <!-- Medical -->
      <div class="row">
        <label><span class="icon-wrap">üè•</span><span class="editable-label" ondblclick="makeEditable(this)" onblur="makeReadOnly(this)" contenteditable="false">Medical ‚Çπ</span></label>
        <input type="number" id="medical" oninput="calculate()" placeholder="0" min="0" step="0.01" />
        <div class="add-row"><input id="medicalAdd" type="number" min="0" step="0.01" placeholder="0" /><button onclick="addTo('medical')">‚ûï Add</button></div>
      </div>

      <!-- Misc -->
      <div class="row">
        <label><span class="icon-wrap">üéÅ</span><span class="editable-label" ondblclick="makeEditable(this)" onblur="makeReadOnly(this)" contenteditable="false">Miscellaneous ‚Çπ</span></label>
        <input type="number" id="misc" oninput="calculate()" placeholder="0" min="0" step="0.01" />
        <div class="add-row"><input id="miscAdd" type="number" min="0" step="0.01" placeholder="0" /><button onclick="addTo('misc')">‚ûï Add</button></div>
      </div>

      <!-- Rent -->
      <div class="row">
        <label><span class="icon-wrap">üè†</span><span class="editable-label" ondblclick="makeEditable(this)" onblur="makeReadOnly(this)" contenteditable="false">Rent ‚Çπ</span></label>
        <input type="number" id="rent" oninput="calculate()" placeholder="0" min="0" step="0.01" />
        <div class="add-row"><input id="rentAdd" type="number" min="0" step="0.01" placeholder="0" /><button onclick="addTo('rent')">‚ûï Add</button></div>
      </div>

      <!-- Broadband -->
      <div class="row">
        <label><span class="icon-wrap">üì°</span><span class="editable-label" ondblclick="makeEditable(this)" onblur="makeReadOnly(this)" contenteditable="false">Broadband ‚Çπ</span></label>
        <input type="number" id="broadband" oninput="calculate()" placeholder="0" min="0" step="0.01" />
        <div class="add-row"><input id="broadbandAdd" type="number" min="0" step="0.01" placeholder="0" /><button onclick="addTo('broadband')">‚ûï Add</button></div>
      </div>

    </div> <!-- end expenses section -->

    <!-- Totals -->
    <div class="totals" aria-live="polite">
      <div class="total-item" id="expensesDisplay">üí∏ Expenses<br /><span id="expenses">‚Çπ0.00</span></div>
      <div class="total-item positive" id="balanceDisplay">‚öñÔ∏è Balance<br /><span id="balance">‚Çπ0.00</span></div>
    </div>

    <!-- Footer -->
    <footer>
      ¬© 2025 Home Budget Calculator. All rights reserved. Developed by Logesh.<br />
      <div class="small">
        Disclaimer: This website provides budgeting tools for informational purposes only and does not constitute financial advice. The developer is not responsible for any financial decisions made based on the information provided here. Users should consult a financial advisor for personalized guidance.
      </div>
    </footer>
  </div>

  <script>
    /* Minimal inline documentation only for 'why' */
    // Why: track which input ids are included in totals and persistence
    const expenseIds = [
      'rice','electricity','milk','cylinder','nonveg','eggs','veggies','canteen','paneer',
      'extras','snacks','ration','provision','fruits','oil','curd','water','flowers',
      'medical','misc','rent','broadband'
    ];

    function formatINR(num){
      if (isNaN(num)) return '‚Çπ0.00';
      return '‚Çπ' + Number(num).toLocaleString('en-IN', {minimumFractionDigits: 2, maximumFractionDigits: 2});
    }

    // increment main value by add input
    function addTo(id){
      const addInput = document.getElementById(id + 'Add');
      const mainInput = document.getElementById(id);
      if(!mainInput || !addInput) return;
      const addVal = parseFloat(addInput.value) || 0;
      const current = parseFloat(mainInput.value) || 0;
      mainInput.value = (current + addVal).toFixed(2);
      addInput.value = '';
      calculate();
    }

    // sum all expenses and update balance
    function calculate(){
      let total = 0;
      expenseIds.forEach(id=>{
        const el = document.getElementById(id);
        if(!el) return;
        const v = parseFloat(el.value) || 0;
        total += v;
      });
      document.getElementById('expenses').textContent = formatINR(total);
      const deposits = parseFloat(document.getElementById('deposits').value) || 0;
      const balance = deposits - total;
      document.getElementById('balance').textContent = formatINR(balance);
      // save snapshot for quick restore
      localStorage.setItem('homeBudget_snapshot', JSON.stringify({
        date: document.getElementById('date').value || '',
        deposits: document.getElementById('deposits').value || 0,
        values: expenseIds.reduce((acc, id) => (acc[id] = document.getElementById(id)?.value || 0, acc), {})
      }));
    }

    function saveEntry(){ calculate(); localStorage.setItem('homeBudget_date', document.getElementById('date').value || '') }

    // editable label handlers: double-click to edit, blur to lock
    function makeEditable(el){
      el.setAttribute('contenteditable','true');
      el.focus();
      document.execCommand('selectAll', false, null);
      document.getSelection().collapseToEnd();
    }
    function makeReadOnly(el){
      el.setAttribute('contenteditable','false');
      if(!el.textContent.trim()) el.textContent = 'Item ‚Çπ';
    }

    // Export PDF (screenshot-style) using html2canvas + jsPDF; splits tall pages into multiple A4 pages
    async function exportPDF(){
      const container = document.getElementById('mainContent');
      // hide interactive controls so they don't appear in the capture
      const controls = document.querySelectorAll('.controls, .add-row button, .add-row input, #exportPdfBtn');
      controls.forEach(c=>c.style.visibility = 'hidden');
      try{
        // high resolution capture
        const canvas = await html2canvas(container, {scale:2, useCORS:true, logging:false, windowWidth: document.documentElement.scrollWidth, windowHeight: document.documentElement.scrollHeight});
        const imgData = canvas.toDataURL('image/png', 1.0);
        const { jsPDF } = window.jspdf;
        const pdf = new jsPDF({unit:'mm', format:'a4'});
        const pageWidth = pdf.internal.pageSize.getWidth();
        const pageHeight = pdf.internal.pageSize.getHeight();

        // image size in px
        const imgW = canvas.width;
        const imgH = canvas.height;
        // convert to mm by ratio scaling to page width with margin 8mm
        const margin = 8;
        const usablePageWidth = pageWidth - margin*2;
        const pdfImgHeight = (imgH * usablePageWidth) / imgW;
        if(pdfImgHeight <= pageHeight - margin*2){
          // fits on one page
          pdf.addImage(imgData, 'PNG', margin, margin, usablePageWidth, pdfImgHeight);
        } else {
          // split vertically into multiple canvas slices
          const pxPerPage = Math.floor((imgW * (pageHeight - margin*2)) / usablePageWidth);
          let position = 0;
          while(position < imgH){
            const sliceHeight = Math.min(pxPerPage, imgH - position);
            const canvasSlice = document.createElement('canvas');
            canvasSlice.width = imgW;
            canvasSlice.height = sliceHeight;
            const ctx = canvasSlice.getContext('2d');
            ctx.drawImage(canvas, 0, position, imgW, sliceHeight, 0, 0, imgW, sliceHeight);
            const chunkImg = canvasSlice.toDataURL('image/png');
            const chunkPdfHeight = (sliceHeight * usablePageWidth) / imgW;
            if(position !== 0) pdf.addPage();
            pdf.addImage(chunkImg, 'PNG', margin, margin, usablePageWidth, chunkPdfHeight);
            position += sliceHeight;
          }
        }
        // restore visibility
        controls.forEach(c=>c.style.visibility = '');
        const fileName = 'Home-Budget-' + (document.getElementById('date').value || new Date().toISOString().slice(0,10)) + '.pdf';
        pdf.save(fileName);
      }catch(err){
        console.error('PDF export error:', err);
        controls.forEach(c=>c.style.visibility = '');
        // fallback to print dialog
        window.print();
      }
    }

    // initialize values from localStorage
    (function init(){
      const snap = JSON.parse(localStorage.getItem('homeBudget_snapshot') || '{}');
      if(snap && snap.values){
        expenseIds.forEach(id=>{
          if(snap.values[id] !== undefined && document.getElementById(id)) document.getElementById(id).value = snap.values[id];
        });
        if(snap.deposits !== undefined) document.getElementById('deposits').value = snap.deposits;
      }
      const savedDate = localStorage.getItem('homeBudget_date') || '';
      if(savedDate) document.getElementById('date').value = savedDate;
      calculate();
    })();

    // prevent Enter key from accidentally submitting the page or losing focus
    document.addEventListener('keydown', function(e){
      if(e.key === 'Enter' && e.target && e.target.tagName === 'INPUT' && e.target.type === 'number'){
        e.preventDefault();
      }
    });
  </script>
</body>
</html>
